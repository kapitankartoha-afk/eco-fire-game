<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Eco Fire ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–∏–π –ø—Ä–æ—Ç–æ—Ç–∏–ø</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
  <style>
    :root{--glass: rgba(255,255,255,0.85); --accent:#2b8aef}
    html,body { height:100%; margin:0; font-family:Inter, system-ui, Arial; background: linear-gradient(180deg,#88c2a6 0%, #e6f7ff 100%); }
    #game-container { width:100%; height:100vh; display:flex; align-items:center; justify-content:center; position:relative; }
    canvas { display:block; border-radius:16px; box-shadow:0 12px 40px rgba(10,20,30,0.15); }

    /* HUD */
    .panel { position:absolute; right:18px; top:18px; width:300px; background:var(--glass); border-radius:12px; padding:12px; box-shadow:0 8px 30px rgba(0,0,0,0.12); }
    .panel h3{margin:0 0 8px 0}
    .fuel-list { display:flex; flex-direction:column; gap:8px; max-height:300px; overflow:auto; }
    .fuel-item { display:flex; justify-content:space-between; align-items:center; padding:8px 10px; border-radius:8px; cursor:pointer; border:1px solid rgba(0,0,0,0.06); background:#fff; }
    .controls { margin-top:10px; display:flex; gap:8px; }
    button.primary { background:var(--accent); color:#fff; padding:8px 10px; border-radius:8px; border:none; cursor:pointer; }
    button.ghost { background:transparent; border:1px solid rgba(0,0,0,0.08); padding:8px 10px; border-radius:8px; cursor:pointer; }
    .stat { margin-top:10px; font-size:14px; }

    /* bottom bar with ignite button */
    .bottom-bar { position:absolute; left:50%; transform:translateX(-50%); bottom:28px; background:var(--glass); padding:10px 14px; border-radius:999px; display:flex; gap:10px; align-items:center; box-shadow:0 10px 30px rgba(0,0,0,0.12); }
    .ignite { background:#e74c3c; color:#fff; border:none; padding:10px 18px; border-radius:999px; cursor:pointer; font-weight:700 }

    /* side markers */
    .scale { position:absolute; left:18px; top:18px; width:220px; background:var(--glass); border-radius:12px; padding:10px; box-shadow:0 6px 24px rgba(0,0,0,0.08); }
    .scale .marker { font-size:13px; margin:8px 0; display:flex; justify-content:space-between; align-items:center; }
    .marker.high { font-weight:700; color:#c0392b; }

    /* modal-like fuel picker (desktop) */
    .picker { position:absolute; left:50%; transform:translateX(-50%); top:60px; background:var(--glass); width:360px; border-radius:12px; padding:12px; display:none; box-shadow:0 18px 40px rgba(0,0,0,0.18); }
    .picker.open{ display:block }
    .picker h4{margin:0 0 8px}
    .picker .available { display:flex; gap:8px; flex-wrap:wrap }
    .chip{ padding:8px 10px; background:#fff; border-radius:10px; border:1px solid rgba(0,0,0,0.06); cursor:pointer }
    .picker .added { margin-top:10px }

    /* small help */
    .help { position:absolute; right:18px; bottom:18px; background:var(--glass); padding:8px 12px; border-radius:10px; box-shadow:0 6px 20px rgba(0,0,0,0.06); }

    @media (max-width:540px){ .panel{ width:240px } .picker{ width:92% } }
  </style>
</head>
<body>
  <div id="game-container"></div>

  <div class="panel" id="panel">
    <h3>–ü–æ—Ç–æ—á–Ω–µ –ø–∞–ª–∏–≤–æ</h3>
    <div id="currentList" style="min-height:64px; display:flex; flex-direction:column; gap:6px;">
      <div style="color:#666;">–ù—ñ—á–æ–≥–æ –Ω–µ –¥–æ–¥–∞–Ω–æ. –ö–ª–∞—Ü–Ω–∏ –ø–æ –≤–æ–≥–Ω–∏—â—É, —â–æ–± –¥–æ–¥–∞—Ç–∏.</div>
    </div>
    <div class="stat">CO‚ÇÇ: <span id="co2">0</span> —Ç</div>
    <div class="stat">–†–∞–¥—ñ—É—Å –∫—É–ª—ñ: <span id="radius">0</span> –º</div>
  </div>

  <div class="picker" id="picker">
    <h4>–î–æ–¥–∞—Ç–∏ –ø–∞–ª–∏–≤–æ</h4>
    <div class="available" id="available"></div>
    <div class="added">
      <strong>–û–±–µ—Ä–µ–Ω—ñ:</strong>
      <div id="picked" style="margin-top:6px; display:flex; gap:6px; flex-wrap:wrap"></div>
    </div>
  </div>

  <div class="scale" id="scale">
    <div style="font-weight:700; margin-bottom:6px;">–ú–∞—Å—à—Ç–∞–± (–ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤–∏—Å–æ—Ç–∏)</div>
    <div class="marker" data-height="2">–õ—é–¥–∏–Ω–∞ <span>2 –º</span></div>
    <div class="marker" data-height="4">–ê–≤—Ç–æ–±—É—Å <span>4 –º</span></div>
    <div class="marker" data-height="12">–°—Ç–æ–≤–ø –ª—ñ—Ö—Ç–∞—Ä—è <span>12 –º</span></div>
    <div class="marker" data-height="50">–î–µ—Ä–µ–≤–æ <span>50 –º</span></div>
    <div class="marker" data-height="110">–ë—ñ–≥-–ë–µ–Ω <span>110 –º</span></div>
    <div class="marker" data-height="828">–ë—É—Ä–¥–∂ –•–∞–ª—ñ—Ñ–∞ <span>828 –º</span></div>
  </div>

  <div class="bottom-bar">
    <div style="font-size:13px; color:#333;">–í–æ–≥–Ω–∏—â–µ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ –ª—ñ—Å—ñ. –î–æ–¥–∞–≤–∞–π –ø–∞–ª–∏–≤–æ —ñ –Ω–∞—Ç–∏—Å–∫–∞–π:</div>
    <button id="igniteBtn" class="ignite">–ü—ñ–¥–ø–∞–ª–∏—Ç–∏</button>
  </div>

  <div class="help">–ö–ª—ñ–∫–Ω–∏ –ø–æ –≤–æ–≥–Ω–∏—â—É (–Ω–∞ —Å—Ü–µ–Ω—ñ), —â–æ–± –≤—ñ–¥–∫—Ä–∏—Ç–∏ –ø–∞–Ω–µ–ª—å –¥–æ–¥–∞–≤–∞–Ω–Ω—è –ø–∞–ª–∏–≤–∞.</div>

<script>
// --------- –ö–æ–Ω—Ñ—ñ–≥ —Ç–∞ –¥–∞–Ω—ñ –ø–∞–ª–∏–≤–∞ ----------
const FUELS = [
  { id:'wood', name:'–î—Ä–æ–≤–∞', smoke:0.6, icon:'ü™µ' },
  { id:'coal', name:'–í—É–≥—ñ–ª–ª—è', smoke:1.6, icon:'‚ö´' },
  { id:'oil', name:'–ù–∞—Ñ—Ç–∞', smoke:3.8, icon:'üõ¢Ô∏è' },
  { id:'plastic', name:'–ü–ª–∞—Å—Ç–∏–∫', smoke:2.4, icon:'üß¥' },
  { id:'truck', name:'–§—É—Ä–∞', smoke:5.2, icon:'üöö' }
];

let pickedFuels = []; // —Å–ø–∏—Å–æ–∫ –¥–æ–¥–∞–Ω–∏—Ö –ø—Ä–µ–¥–º–µ—Ç—ñ–≤
let co2Tonnes = 0;
let atmosphereRadius = 120; // —Å—Ç–∞—Ä—Ç–æ–≤–∏–π —Ä–∞–¥—ñ—É—Å –∫—É–ª—ñ (–ø—ñ–∫—Å–µ–ª—ñ) ‚Äî –Ω–µ–∑–º—ñ–Ω–Ω–∏–π –±–∞–∑–æ–≤–∏–π —Ä–æ–∑–º—ñ—Ä
let atmosphereTarget = atmosphereRadius; // –∫–æ–ª–∏ –¥–æ–¥–∞—î—Ç—å—Å—è –¥–∏–º, —Ü—ñ–ª—å —Ä–æ—Å—Ç–µ
let atmosphereGraphics, sceneRef;
let markers = [];

const config = {
  type: Phaser.AUTO,
  parent: 'game-container',
  width: 420,
  height: 800,
  backgroundColor: 0x88c2a6,
  scale: { mode: Phaser.Scale.FIT, autoCenter: Phaser.Scale.CENTER_BOTH },
  scene: { preload, create, update }
};
const game = new Phaser.Game(config);

function preload() {
  // –º–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ —Å–ø—Ä–∞–π—Ç–∏ –ø—ñ–∑–Ω—ñ—à–µ
}

function create() {
  const scene = this; sceneRef = scene;
  const cx = scene.cameras.main.centerX;
  const cy = scene.cameras.main.centerY;

  // —Ñ–æ–Ω: –Ω–µ–±–æ -> –¥–µ—Ä–µ–≤–∏ -> —Ç—Ä–∞–≤–∞
  scene.add.rectangle(cx, 0, 2000, 480, 0x87CEEB).setOrigin(0.5,0);
  // –Ω–∞—Ä–∏—Å—É–≤–∞—Ç–∏ –ø—Ä–æ—Å—Ç—ñ –¥–µ—Ä–µ–≤—Ü—è —Ä—è–¥–∞–º–∏
  const treeRowY = 420;
  for(let i=-10;i<=10;i++){
    const tx = cx + i*60 + (i%2?10:-10);
    const trunk = scene.add.rectangle(tx, treeRowY+30, 12, 40, 0x7a4a2b).setOrigin(0.5);
    const leaves = scene.add.circle(tx, treeRowY, 36, 0x1b8a47).setAlpha(0.95);
  }

  // —Ç—Ä–∞–≤–∞
  scene.add.rectangle(cx, 700, 2000, 220, 0x6bbf59).setOrigin(0.5,0);

  // –≤–æ–≥–Ω–∏—â–µ (—ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–µ) –≤–Ω–∏–∑—É —Ü–µ–Ω—Ç—Ä—É
  const fireX = cx; const fireY = 620;
  const fireBase = scene.add.ellipse(fireX, fireY+8, 120, 36, 0x3d2b1f).setAlpha(0.95);
  const flame = scene.add.ellipse(fireX, fireY-10, 68, 68, 0xff6b35).setAlpha(0.95);
  const fireHit = scene.add.circle(fireX, fireY, 86, 0xffffff, 0.001).setInteractive({useHandCursor:true});
  fireHit.on('pointerdown', ()=> togglePicker());

  // –ê—Ç–º–æ—Å—Ñ–µ—Ä–∞ (–∫—É–ª—è) —Ü–µ–Ω—Ç—Ä–æ–≤–∞–Ω–∞ –Ω–∞–¥ –≤–æ–≥–Ω–∏—â–µ–º, –∞–ª–µ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤–≥–æ—Ä—ñ
  atmosphereGraphics = scene.add.graphics();
  drawAtmosphere(scene);

  // side objects container ‚Äî –º–∏ –ø–æ–∫–∞–∂–µ–º–æ —ñ–∫–æ–Ω–∫–∏ –∫–æ–ª–∏ –ø–µ—Ä–µ–≤–∏—â–µ–Ω–æ
  const sideX = scene.cameras.main.width - 110;
  for(let i=0;i<6;i++){
    const y = 160 + i*80;
    const icon = scene.add.text(sideX, y, '', {fontSize:'20px'}).setOrigin(0.5).setAlpha(0);
    markers.push(icon);
  }

  // –ø—ñ–¥–ø–∏—Å
  scene.add.text(18,18,'Eco Fire ‚Äî –ª—ñ—Å–æ–≤–∏–π –ø—Ä–æ—Ç–æ—Ç–∏–ø',{fontSize:'14px', color:'#042'});

  setupDOM();
}

function update(time, delta) {
  // –ø–æ–≤—ñ–ª—å–Ω–µ –∑–±—ñ–ª—å—à–µ–Ω–Ω—è –∫—É–ª—ñ –¥–æ —Ü—ñ–ª—ñ ‚Äî –≤–æ–Ω–∞ —Ä–æ—Å—Ç–µ —ñ –Ω–µ –∑–º–µ–Ω—à—É—î—Ç—å—Å—è
  if (atmosphereRadius < atmosphereTarget) {
    atmosphereRadius += Math.max(0.6, (atmosphereTarget - atmosphereRadius) * 0.06);
    drawAtmosphere(sceneRef);
    updateDOM();
    checkMarkers();
  }
}

function drawAtmosphere(scene){
  atmosphereGraphics.clear();
  const cx = scene.cameras.main.centerX;
  const cy = 260; // —Ñ—ñ–∫—Å–æ–≤–∞–Ω–∞ –≤–∏—Å–æ—Ç–∞ –∫—É–ª—ñ

  // —Ç–æ–Ω–∫–∞ –≥—Ä–∞–Ω–∏—Ü—è –∫—É–ª—ñ
  atmosphereGraphics.lineStyle(3, 0x222222, 0.25);
  atmosphereGraphics.strokeCircle(cx, cy, atmosphereRadius);

  // –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –¥–∏–º–æ–º (—á–æ—Ä–Ω–∏–π –∑ –ø—Ä–æ–∑–æ—Ä—ñ—Å—Ç—é –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ co2Tonnes)
  const alpha = Math.min(0.85, 0.08 + Math.log1p(co2Tonnes) * 0.12);
  atmosphereGraphics.fillStyle(0x000000, alpha);
  atmosphereGraphics.fillCircle(cx, cy, atmosphereRadius * 0.82);
}

// --- DOM —ñ –≤–∑–∞—î–º–æ–¥—ñ—è ---
function setupDOM(){
  const available = document.getElementById('available');
  FUELS.forEach(f => {
    const el = document.createElement('div'); el.className='chip'; el.innerText = `${f.icon} ${f.name}`;
    el.onclick = ()=> addPicked(f);
    available.appendChild(el);
  });

  document.getElementById('igniteBtn').onclick = ()=> ignite();
}

function togglePicker(){
  const p = document.getElementById('picker');
  p.classList.toggle('open');
}

function addPicked(fuel){
  pickedFuels.push(fuel);
  co2Tonnes += fuel.smoke * 0.12; // —É–º–æ–≤–Ω–∞ –º–æ–¥–µ–ª—å
  // –æ–Ω–æ–≤–∏—Ç–∏ DOM —Å–ø–∏—Å–∫—É –æ–±—Ä–∞–Ω–∏—Ö
  renderPicked();
  updateDOM();
}

function renderPicked(){
  const picked = document.getElementById('picked'); picked.innerHTML = '';
  const cur = document.getElementById('currentList'); cur.innerHTML = '';
  if (pickedFuels.length===0){ cur.innerHTML = '<div style="color:#666">–ù—ñ—á–æ–≥–æ –Ω–µ –¥–æ–¥–∞–Ω–æ. –ö–ª–∞—Ü–Ω–∏ –ø–æ –≤–æ–≥–Ω–∏—â—É.</div>'; }
  pickedFuels.forEach((f, idx)=>{
    const chip = document.createElement('div'); chip.className='chip'; chip.innerText = `${f.icon} ${f.name}`;
    chip.onclick = ()=> removePicked(idx);
    picked.appendChild(chip);

    const row = document.createElement('div'); row.className='fuel-item'; row.innerHTML = `<div>${f.icon} ${f.name}</div><div>${f.smoke} d</div>`;
    cur.appendChild(row);
  });
}

function removePicked(i){
  const f = pickedFuels.splice(i,1)[0];
  co2Tonnes = Math.max(0, co2Tonnes - f.smoke * 0.12);
  renderPicked(); updateDOM();
}

function ignite(){
  if (pickedFuels.length===0) return alert('–ù–µ–º–∞—î –ø–∞–ª–∏–≤–∞ ‚Äî –¥–æ–¥–∞–π —Ö–æ—á —â–æ—Å—å, –∫–ª—ñ–∫–Ω—É–≤—à–∏ –ø–æ –≤–æ–≥–Ω–∏—â—É.');
  // —Å—É–∫—É–ø–Ω–∏–π –≤–Ω–µ—Å–æ–∫ smoke
  const totalSmoke = pickedFuels.reduce((s,f)=>s+f.smoke,0);
  // –º–µ–ø–ø—ñ–Ω–≥: –∫–æ–∂–µ–Ω smoke –æ–¥–∏–Ω–∏—Ü—è –¥–∞—î +60 –ø—ñ–∫—Å–µ–ª—ñ–≤
  const addPixels = totalSmoke * 60;
  atmosphereTarget = Math.max(atmosphereTarget, atmosphereRadius + addPixels);
  // –ø—ñ—Å–ª—è –ø—ñ–¥–ø–∞–ª—É ‚Äî —Å–ø–∏—Å–æ–∫ –æ—á–∏—â–∞—î—Ç—å—Å—è, –∞–ª–µ –∫—É–ª—è –Ω–µ –∑–º–µ–Ω—à—É—î—Ç—å—Å—è
  pickedFuels = [];
  renderPicked();
  updateDOM();
}

function updateDOM(){
  document.getElementById('co2').innerText = co2Tonnes.toFixed(2);
  // —É–º–æ–≤–Ω–∏–π –ø–µ—Ä–µ—Ç–≤–æ—Ä—é–≤–∞—á –ø—ñ–∫—Å—ñ –≤ –º–µ—Ç—Ä–∏ ‚Äî 1 –ø—ñ–∫—Å–µ–ª—å = 2 –º–µ—Ç—Ä–∏
  const meters = Math.round(atmosphereRadius * 2);
  document.getElementById('radius').innerText = meters;
}

function checkMarkers(){
  // —è–∫—â–æ –∫—É–ª—è (—É –º–µ—Ç—Ä–∞—Ö) –ø–µ—Ä–µ–≤–∏—â–∏–ª–∞ –∑–Ω–∞—á–µ–Ω–Ω—è –º–∞—Ä–∫–µ—Ä–∞ ‚Äî –ø–æ–∫–∞–∑–∞—Ç–∏ —ñ–∫–æ–Ω–∫—É
  const meters = atmosphereRadius * 2;
  const markerDefs = [ {h:2,icon:'üö∂'}, {h:4,icon:'üöå'}, {h:12,icon:'üí°'}, {h:50,icon:'üå≤'}, {h:110,icon:'üï∞Ô∏è'}, {h:828,icon:'üóº'} ];
  markerDefs.forEach((m, i)=>{
    const txt = markers[i];
    if (meters >= m.h && txt.alpha===0){
      txt.setText(`${m.icon} ${m.h}m`).setAlpha(1).setScale(0.9).setOrigin(0.5);
      // –ø–ª–∞–≤–Ω–∞ –∞–Ω—ñ–º–∞—Ü—ñ—è –ø–æ—è–≤–∏
      sceneRef.tweens.add({ targets: txt, scale:1.15, duration:400, yoyo:true });
      // –ø—ñ–¥—Å–≤—ñ—Ç–∏—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–π scale –º–∞—Ä–∫–µ—Ä –≤ DOM
      const domMarkers = document.querySelectorAll('.scale .marker');
      if (domMarkers[i]) domMarkers[i].classList.add('high');
    }
  });
}

</script>
</body>
</html>
