<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Eco Fire ‚Äî –ø—Ä–æ—Ç–æ—Ç–∏–ø</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
  <style>
    html,body { height:100%; margin:0; font-family:Inter, system-ui, Arial; background: linear-gradient(#89c2ff, #e6f7ff); }
    #game-container { width:100%; height:100vh; display:flex; align-items:center; justify-content:center; }
    canvas { display:block; }

    /* HUD overlay */
    .hud { position: absolute; right:18px; top:18px; width:260px; background: rgba(255,255,255,0.9); border-radius:12px; padding:12px; box-shadow:0 8px 30px rgba(0,0,0,0.12); }
    .hud h3 { margin:6px 0 8px; font-size:16px; }
    .fuel-list { display:flex; flex-direction:column; gap:6px; max-height:240px; overflow:auto; }
    .fuel-btn { display:flex; justify-content:space-between; align-items:center; padding:8px 10px; border-radius:8px; cursor:pointer; border:1px solid rgba(0,0,0,0.06); background:#fff; }
    .controls { margin-top:10px; display:flex; gap:8px; }
    button.primary { background:#2b8aef; color:#fff; padding:8px 10px; border-radius:8px; border:none; cursor:pointer; }
    button.ghost { background:transparent; border:1px solid rgba(0,0,0,0.08); padding:8px 10px; border-radius:8px; cursor:pointer; }
    .stat { margin-top:10px; font-size:14px; }
    .scale { position:absolute; left:18px; top:18px; width:140px; background: rgba(255,255,255,0.85); border-radius:12px; padding:10px; box-shadow:0 6px 24px rgba(0,0,0,0.08); }
    .scale .marker { font-size:13px; margin:8px 0; display:flex; justify-content:space-between; align-items:center; }
    .marker .bar { height:8px; width:40px; background:#eee; border-radius:4px; margin-left:8px; }
    .marker.high { font-weight:700; color:#c0392b; }
    /* small help */
    .help { position:absolute; left:18px; bottom:18px; background:rgba(255,255,255,0.9); padding:8px 12px; border-radius:10px; box-shadow:0 6px 20px rgba(0,0,0,0.06); }
  </style>
</head>
<body>
  <div id="game-container"></div>

  <div class="hud" id="hud">
    <h3>–ü–∞–ª–∏–≤–∞ (–Ω–∞—Ç–∏—Å–Ω–∏ —â–æ–± –¥–æ–¥–∞—Ç–∏)</h3>
    <div class="fuel-list" id="fuelList"></div>

    <div class="controls">
      <button id="igniteBtn" class="primary">–ü—ñ–¥–ø–∞–ª–∏—Ç–∏</button>
      <button id="clearBtn" class="ghost">–û—á–∏—Å—Ç–∏—Ç–∏</button>
    </div>

    <div class="stat">CO‚ÇÇ: <span id="co2">0</span> —Ç</div>
    <div class="stat">–ö—É–ª—è: <span id="radius">0</span> –º</div>
  </div>

  <div class="scale" id="scale">
    <div style="font-weight:700; margin-bottom:6px;">–ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –º–∞—Å—à—Ç–∞–±—É</div>
    <div class="marker" data-height="6">–õ—é–¥–∏–Ω–∞ <div class="bar" style="width:20px"></div></div>
    <div class="marker" data-height="4">–ê–≤—Ç–æ–±—É—Å <div class="bar" style="width:36px"></div></div>
    <div class="marker" data-height="12">–°—Ç–æ–≤–ø –ª—ñ—Ö—Ç–∞—Ä—è <div class="bar" style="width:60px"></div></div>
    <div class="marker" data-height="200">–•–∞—Ç–∏–Ω–∫–∞ <div class="bar" style="width:90px"></div></div>
    <div class="marker" data-height="828">–î—É–±–∞–π—Å—å–∫–∞ –≤–µ–∂–∞ (–ë—É—Ä–¥–∂ –•–∞–ª—ñ—Ñ–∞) <div class="bar" style="width:120px"></div></div>
  </div>

  <div class="help">–Ü–¥–µ—è: –¥–æ–¥–∞–≤–∞–π –ø–∞–ª–∏–≤–æ -> —Å–ø–∞–ª–∏ -> –ø–æ–±–∞—á–∏—à —è–∫ –∫—É–ª—è –∑ –¥–∏–º–æ–º –∑—Ä–æ—Å—Ç–∞—î. –ù–∞—Ç–∏—Å–Ω–∏ &quot;–û—á–∏—Å—Ç–∏—Ç–∏&quot; —â–æ–± –ø–æ—á–∞—Ç–∏ —Å–ø–æ—á–∞—Ç–∫—É.</div>

<script>
// ----- –ü—Ä–æ—Å—Ç–∏–π Phaser-–ø—Ä–æ—Ç–æ—Ç–∏–ø -----
const config = {
  type: Phaser.AUTO,
  parent: 'game-container',
  width: 420,
  height: 800,
  backgroundColor: 0x87CEEB,
  scale: { mode: Phaser.Scale.FIT, autoCenter: Phaser.Scale.CENTER_BOTH },
  scene: { preload, create, update }
};
const game = new Phaser.Game(config);

let smokeValue = 0; // –∫—ñ–ª—å–∫—ñ—Å—Ç—å "–¥–∏–º—É" —â–æ —Å—Ç–≤–æ—Ä–µ–Ω–æ
let atmosphereRadius = 0; // –≤ –ø—ñ–∫—Å–µ–ª—è—Ö –Ω–∞ —Å—Ü–µ–Ω—ñ
let atmosphereTarget = 0;
let atmosphereGraphics;
let fireGroup;
let itemsVisual = [];
let co2Tonnes = 0;

// –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –ø–∞–ª–∏–≤–∞
const FUELS = [
  { id:'wood', name:'–î—Ä–æ–≤–∞', smoke:0.5, icon:'ü™µ' },
  { id:'coal', name:'–í—É–≥—ñ–ª–ª—è', smoke:1.4, icon:'‚ö´' },
  { id:'oil', name:'–ù–∞—Ñ—Ç–∞ (—Ç–∞–Ω–∫–µ—Ä)', smoke:3.6, icon:'üõ¢Ô∏è' },
  { id:'plastic', name:'–ü–ª–∞—Å—Ç–∏–∫', smoke:2.2, icon:'üß¥' },
  { id:'truck', name:'–§—É—Ä–∞', smoke:5.0, icon:'üöö' }
];

function preload() {
  // —Ç—É—Ç –º–æ–∂–Ω–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Å–ø—Ä–∞–π—Ç–∏. –î–ª—è –ø—Ä–æ—Å—Ç–æ—Ç–∏ –º–∏ –º–∞–ª—é—î–º–æ –≥—Ä–∞—Ñ—ñ–∫–æ—é
}

function create() {
  const scene = this;

  // –º—ñ—Å—Ü–µ –¥–ª—è –∫–∞—Ä–∞–∫—Ç–µ—Ä–∞ —ñ –≤–æ–≥–Ω–∏—â–∞
  const cx = this.cameras.main.centerX;
  const groundY = 600;

  // —Ñ–æ–Ω –∑–µ–º–ª—è
  const ground = this.add.rectangle(cx, groundY+90, 900, 260, 0x6bbf59).setOrigin(0.5,0);

  // —Ö–ª–æ–ø–µ—Ü—å (—Å–∏–ª—å–Ω–æ –ø—Ä–æ—Å—Ç–∏–π —Å–∏–º–≤–æ–ª)
  const boy = this.add.container(cx, groundY-20);
  const body = this.add.rectangle(0,0,44,70,0x2c3e50).setOrigin(0.5);
  const pack = this.add.rectangle(-8,6,28,34,0x8b5a2b).setOrigin(0.5);
  boy.add([body, pack]);
  boy.setSize(44,70);
  boy.setInteractive({useHandCursor:true});

  // –≤–æ–≥–Ω–∏—â–µ
  fireGroup = this.add.container(cx, groundY+10);
  const fireBase = this.add.ellipse(0,18,80,24,0x3d2b1f).setAlpha(0.9);
  const flame = this.add.ellipse(0,-6,48,48,0xff6b35).setAlpha(0.9);
  fireGroup.add([fireBase, flame]);

  // –∞—Ç–º–æ—Å—Ñ–µ—Ä–∞ (–ø—Ä–æ–∑–æ—Ä–∞ –∫—É–ª—è –Ω–∞–¥ –≤–æ–≥–Ω–∏—â–µ–º)
  atmosphereGraphics = this.add.graphics();

  // interactivity: –∫–ª—ñ–∫ –ø–æ —Ö–ª–æ–ø—Ü—é –≤—ñ–¥–∫—Ä–∏–≤–∞—î —Å–ø–∏—Å–æ–∫ –¥–æ–¥–∞—Ç–∏ –ø–∞–ª–∏–≤–æ
  boy.on('pointerdown', () => openFuelMenu());

  // add small indicator items area
  this.add.text(18,18,'–ï–∫–æ-–≥—Ä–∞ –ø—Ä–æ—Ç–æ—Ç–∏–ø',{fontSize:'14px', color:'#042'});

  // –ø—Ä–∏–∫–ª–∞–¥–∏ –ø—Ä–µ–¥–º–µ—Ç—ñ–≤ –Ω–∞–≤–∫–æ–ª–æ
  this.add.text(18,730,'–ù–∞—Ç–∏—Å–Ω–∏ –Ω–∞ —Ö–ª–æ–ø—Ü—è —â–æ–± –¥–æ–¥–∞—Ç–∏ –ø–∞–ª–∏–≤–æ', {fontSize:'13px', color:'#333'});

  // —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü—ñ—è –∫–Ω–æ–ø–æ–∫ DOM
  setupHUD(scene);
}

function update(time, delta) {
  // –ø–ª–∞–≤–Ω–µ –∑–±—ñ–ª—å—à–µ–Ω–Ω—è –∞—Ç–º–æ—Å—Ñ–µ—Ä–∏ –¥–æ —Ü—ñ–ª—ñ
  if (atmosphereRadius < atmosphereTarget) {
    atmosphereRadius += Math.min((atmosphereTarget - atmosphereRadius) * 0.08 + 0.6, 6);
    drawAtmosphere(this);
    updateHUD();
  }
}

function drawAtmosphere(scene) {
  atmosphereGraphics.clear();
  const cx = scene.cameras.main.centerX;
  const cy = 300; // —Ü–µ–Ω—Ç—Ä –∫—É–ª—ñ –≤–∏—â–µ
  // –∑–æ–≤–Ω—ñ—à–Ω—î –∫–æ–ª–æ (—Ç–æ–Ω–∫–∞ –≥—Ä–∞–Ω–∏—Ü—è)
  atmosphereGraphics.lineStyle(3, 0x222222, 0.25);
  atmosphereGraphics.strokeCircle(cx, cy, atmosphereRadius);
  // –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –¥–∏–º–æ–º (—á–æ—Ä–Ω–∏–π –∑ –ø—Ä–æ–∑–æ—Ä—ñ—Å—Ç—é —è–∫–∏–π —Ä–æ—Å—Ç–µ —ñ–∑ smokeValue)
  const alpha = Math.min(0.7, 0.05 + Math.log1p(smokeValue) * 0.12);
  atmosphereGraphics.fillStyle(0x000000, alpha);
  atmosphereGraphics.fillCircle(cx, cy, atmosphereRadius * (0.8));
}

// HUD / DOM interaction
function setupHUD(scene) {
  const fuelList = document.getElementById('fuelList');
  fuelList.innerHTML = '';
  FUELS.forEach(f => {
    const btn = document.createElement('div');
    btn.className = 'fuel-btn';
    btn.innerHTML = `<div>${f.icon} &nbsp; ${f.name}</div><div>${f.smoke} d</div>`;
    btn.onclick = () => addFuel(scene, f);
    fuelList.appendChild(btn);
  });

  document.getElementById('igniteBtn').onclick = () => ignite(scene);
  document.getElementById('clearBtn').onclick = () => resetScene(scene);
}

function addFuel(scene, fuel) {
  // –≤—ñ–∑—É–∞–ª—å–Ω–æ –ø–æ–∫–∞–∑–∞—Ç–∏ –ø—Ä–µ–¥–º–µ—Ç –±—ñ–ª—è –≤–æ–≥–Ω–∏—â–∞
  const ix = scene.cameras.main.centerX + (Math.random()*80 - 40);
  const iy = 540 + (Math.random()*16 - 8);
  const g = scene.add.text(ix, iy, fuel.icon, {fontSize:'28px'}).setOrigin(0.5);
  itemsVisual.push(g);
  // –Ω–∞–∫–æ–ø–∏—á—É—î–º–æ –¥–∏–º–æ–≤–∏–π –≤–Ω–µ—Å–æ–∫
  smokeValue += fuel.smoke;
  // –∑–±—ñ–ª—å—à—É—î–º–æ CO2 (–ø—Ä–æ—Å—Ç–∞ –º–æ–¥–µ–ª—å), –ø—Ä–∏–ø—É—Å—Ç–∏–º–æ smokeValue —Ç–æ–Ω–Ω * –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç
  co2Tonnes += fuel.smoke * 0.12;
  document.getElementById('co2').innerText = co2Tonnes.toFixed(2);
  document.getElementById('radius').innerText = Math.round(atmosphereRadius);
}

function ignite(scene) {
  if (smokeValue <= 0) return alert('–°–ø–µ—Ä—à—É –¥–æ–¥–∞–π—Ç–µ –ø–∞–ª–∏–≤–æ! –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –Ω–∞ —Ö–ª–æ–ø—Ü—è.');
  // –≤–∏–∑–Ω–∞—á–∞—î–º–æ —Ü—ñ–ª—å–æ–≤–∏–π —Ä–æ–∑–º—ñ—Ä –∫—É–ª—ñ —É "–º–µ—Ç—Ä–∞—Ö" —É–º–æ–≤–Ω–æ ‚Äî –º–∞—Å—à—Ç–∞–±—É—î–º–æ
  // –¥–ª—è –Ω–∞–æ—á–Ω–æ–≥–æ –ø—Ä–∏–∫–ª–∞–¥—É: –∫–æ–∂–µ–Ω –ø—É–Ω–∫—Ç smoke -> 40 –ø—ñ–∫—Å–µ–ª—ñ–≤
  atmosphereTarget = atmosphereRadius + smokeValue * 40 + 60;
  // –∫–æ–ª–∏ –ø—ñ–¥–ø–∞–ª–µ–Ω–æ, —Å–ø–∞–ª–∏–ª–∏ - —Å–∫–∏–¥–∞—î–º–æ –∑–∞–ø–∞—Å
  smokeValue = 0;
  // –ø—ñ–¥–∫—Ä–µ—Å–ª–∏—Ç–∏ —Ä—ñ–≤–Ω—ñ —É scale
  highlightScaleMarkers(atmosphereTarget);
}

function resetScene(scene) {
  // –≤–∏–¥–∞–ª—è—î–º–æ –≤—ñ–∑—É–∞–ª—å–Ω—ñ –ø—Ä–µ–¥–º–µ—Ç–∏
  itemsVisual.forEach(i => i.destroy());
  itemsVisual = [];
  smokeValue = 0;
  atmosphereRadius = 0;
  atmosphereTarget = 0;
  co2Tonnes = 0;
  document.getElementById('co2').innerText = co2Tonnes.toFixed(2);
  document.getElementById('radius').innerText = Math.round(atmosphereRadius);
  atmosphereGraphics.clear();
  // –≤–∏–¥–∞–ª–∏—Ç–∏ –ø—ñ–¥—Å–≤—ñ—Ç–∫—É –º–∞—Ä–∫–µ—Ä—ñ–≤
  document.querySelectorAll('.scale .marker').forEach(m => m.classList.remove('high'));
}

function updateHUD() {
  document.getElementById('radius').innerText = Math.round(atmosphereRadius);
}

function highlightScaleMarkers(radiusPixels) {
  // –º–∏ –∫–æ–Ω–≤–µ—Ä—Ç—É—î–º–æ –ø—ñ–∫—Å–µ–ª—ñ –¥–æ —É—è–≤–Ω–∏—Ö –º–µ—Ç—Ä—ñ–≤ –∑–∞ –ø—Ä–æ—Å—Ç–∏–º –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–æ–º
  // —Ç—É—Ç 1 –ø—ñ–∫—Å–µ–ª—å = 2 –º–µ—Ç—Ä–∏ (—É–º–æ–≤–Ω–æ) ‚Äî –º–æ–∂–Ω–∞ –∑–º—ñ–Ω–∏—Ç–∏
  const pxToM = 2;
  const meter = radiusPixels * pxToM;
  const markers = document.querySelectorAll('.scale .marker');
  markers.forEach(m => {
    const h = Number(m.getAttribute('data-height'));
    if (meter >= h) m.classList.add('high');
    else m.classList.remove('high');
  });
}

function openFuelMenu() {
  // –ø—Ä–æ—Å—Ç–∏–π UX: –ø—ñ–¥—Å–≤—ñ—Ç–∏—Ç–∏ —Å–ø–∏—Å–æ–∫ (–≤–∂–µ –≤–∏–¥–Ω–æ)
  const el = document.getElementById('hud');
  // –¥—Ä—ñ–±–Ω–∞ –∞–Ω—ñ–º–∞—Ü—ñ—è
  document.querySelector('.hud').style.transform = 'scale(1.02)';
  setTimeout(()=>document.querySelector('.hud').style.transform = 'none', 200);
}
</script>
</body>
</html>
